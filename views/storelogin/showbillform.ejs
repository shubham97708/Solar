<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="/assets/img/favicon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Users</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
        name='viewport' />
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css"
        href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <!-- CSS Files -->
    <link href="/assets/css/material-dashboard.css?v=2.1.0" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
</script>
</head>

<body class="">
    <div class="wrapper ">
        <div class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header card-header-danger">
                                <h4 class="card-title ">Bill Window</h4>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <tr>

                                            <button class="btn btn-warning" id="getcustomer">Get Customer By
                                                Mobile</button>
                                            <button class="btn btn-warning" id="getcustcard">Get Customer By
                                                Card</button>
                                        </tr>



                                        <button type="button" class="btn btn-info" id="addnewrow" required>
                                            Add New Row
                                        </button>
                                        <button type="button" class="btn btn-danger" id="removerow">
                                            Delete Row
                                        </button>
                                    </table>
                                    <form method="POST" action="/storelogin/sold">
                                        <table>
                                            <thead class="table">
                                                <tr>
                                                    <td> <input name="storeid" id="storeid" hidden
                                                            value="<%= data[0].id %>">
                                                        <input name="storename" hidden value="<%= data[0].name %>">
                                                        <input name="storemobile" hidden value="<%= data[0].mobilebill %>">
                                                        <input name="storeaddress" hidden
                                                            value="<%= data[0].address %>">
                                                        <input name="storegstno" hidden value="<%= data[0].gstno %>">
                                                        <input name="totalrows" hidden id="totalrows">
                                                    </td>
                                                    <td>
                                                        <h4 class="card-title ">Customer</h4>
                                                    </td>
                                                    <td><input class="form-control" type="number" id="cmobile"
                                                            name="cmobile" placeholder="Mobile No."  required></td>
                                                    <td><input class="form-control" type="number" id="ccard" name="ccard"
                                                            placeholder="Card No." ></td>
                                                    <td><input class="form-control" type="text" id="cname" name="cname"
                                                            placeholder="Customer Name" required></td>
                                                    <td><input class="form-control" type="text" id="cadd" name="cadd"
                                                            placeholder="Customer Address" required></td>
                                                    <td><input class="form-control" type="text" id="cgstno"
                                                            name="cgstno"  placeholder="ITC-GSTIN (Optional)"></td>

                                                </tr>



                                            </thead>
                                            <tr>
                                                <td>&nbsp;</td>
                                            </tr>
                                            <tbody id="rows">

                                            </tbody>
                                            <tr>
                                                <td>&nbsp;</td>
                                            </tr>

                                            <tr>
                                                <td>
                                                    <h4 class="card-title ">Payment</h4>
                                                </td>
                                                <td>&nbsp;</td>
                                                <td>
                                                    <select class="form-control" name="paytype" id="paytype" required>
                                                        <option value="">Select Payment Type</option>
                                                        <option value="cash">Cash</option>
                                                        <option value="card">Card</option>
                                                        <option value="cheque">Cheque</option>
                                                        <option value="finance">Finance</option>
                                                    </select>
                                                </td>

                                                <td>

                                                    <select class="form-control" name="fcname" id="fcname"  >
                                                        <option value="0">Select Bank</option>
                                                        <option value="hdb">HDB</option>
                                                        <option value="homecredit">Home Credit</option>
                                                        <option value="bajaj">Bajaj</option>
                                                        <option value="capitalfirst">Capital First</option>
                                                        <option value="hdfc">HDFC Bank</option>
                                                        <option value="Dmi-Samsung">Dmi Samsung</option>
                                                        
                                                    </select>
                                                </td>
                                                
                                                    <td><input type='number' id='test' class="form-control" data-default="0" name='test' placeholder='Enter Down-Payment'></td>
                                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                    <td> See Remaining Payment here..&nbsp;&nbsp;</td>&nbsp;&nbsp;
                                                    <td><input class="form-control" type="text" id="dp"
                                                        name="dp" placeholder="DownPayment" value="0" readonly ></td>
                                                </tr>
                                            <tr>
                                                <td>&nbsp;</td>
                                            </tr>
                                            <tr>
                                                <td>&nbsp;</td>
                                                <td>&nbsp;</td>
                                                <td>&nbsp;</td>
                                                <td>&nbsp;</td>
                                                <td><input class="btn btn-success" type="submit" value="Submit" id='sub'></td>
                                            </tr>

                                        </table>


                                    </form>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="footer">
            <div class="container-fluid">
                <div class="copyright float-right">
                    &copy;
                    &nbsp;Devloped By SHUBHAM SONI
                </div>
            </div>
        </footer>
    </div>
    <!--   Core JS Files   -->
    <script src="/assets/js/core/jquery.min.js" type="text/javascript"></script>
    <script src="/assets/js/core/popper.min.js" type="text/javascript"></script>
    <script src="/assets/js/core/bootstrap-material-design.min.js" type="text/javascript"></script>
    <script src="/assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
    <!-- Chartist JS -->
    <script src="/assets/js/plugins/chartist.min.js"></script>
    <!--  Notifications Plugin    -->
    <script src="/assets/js/plugins/bootstrap-notify.js"></script>
    <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
    <script src="/assets/js/material-dashboard.min.js?v=2.1.0" type="text/javascript"></script>
    <!-- Material Dashboard DEMO methods, don't include it in your project! -->
    <script src="/assets/demo/demo.js"></script>

    <script>
        //-----------for fill mobile --------------

        var totalrows = 0;
        var total=0
        $('document').ready(function(){
            //$('#test').val(0)
          
            $('#sub').attr('disabled',true)
            $('#addnewrow').click(function(){
                $('#sub').removeAttr('disabled')
            })
            $('#test').hide()
           $('#fcname').hide()
           $('#removerow').click(function(){
               if(totalrows>0){
                $('#sub').removeAttr('disabled')

               }
               else{
                $('#sub').attr('disabled',true)
               }
           })
            $('#paytype').change(function(){
               // alert($('#paytype').val())
            if($('#paytype').val()=="finance"){
                
                $('#fcname').show() 
            }
            else{
        
           // $('#fcname').val("0")
            $('#test').val('Enter Down-Payment') 
            $('#test').hide() 
            $('#fcname').hide()
           // $('#fcname').attr('disabled',true) 
            }
        })
$('#fcname').click(function(){
    
   
    $('#test').show()
$('#test').change(function(){// alert("Entry")
   
   for(var i=1;i<=totalrows;i++)
{       total+=parseInt($(`#price${i}`).val())
}
//alert(total)
    total-=$('#test').val()
    
$('#dp').val(`   Rs.${total}`)
total=0   
})
})
})


// function call(){
//     if($('#fcname').val()=="Downpayment"){
    
   

//        // total+=$(`#price${totalrows}`).val()
//        for(var i=1;i<=totalrows;i++)
//     {       total+=parseInt(`price${i}`.value)
//     alert(`price${i}`.value)
    
    
//     }
//     alert(total)
     
//     dp.val(`   Rs.${total}`)
//     total=0
    
    
//     }

    
// }

        function newrow() {
            totalrows++;
            $('#totalrows').val(totalrows);
            return (
                `<tr id="row${totalrows}">
            <td>
                ${totalrows}
            </td>
            <td>
                <input  class="btn btn-info" type="button" required onclick="myclick(${totalrows})" value="Get" >
            </td>
            <td>
                <input class="form-control" required id="imeimob${totalrows}" type="text" name="imeimob${totalrows}" placeholder="Enter IMEI/Serial"  >
            </td>
            <td>
                <input class="form-control" required   type="text" id="ptype${totalrows}" name="ptype${totalrows}" placeholder="Product Type"  >
                           
            </td>
            <td>
                <input class="form-control" required type="text" id="brandname${totalrows}" name="brandname${totalrows}" placeholder="Brand Name"  >
                
            </td>
            
            <td>
                <input class="form-control" required  type="text" id="color${totalrows}" name="color${totalrows}" placeholder="Color"  >
                
            </td>
            <td>
                <input class="form-control" required type="text" id="modelname${totalrows}" name="modelname${totalrows}" placeholder="Model Name"  >            
            </td>
            <td>
                <input class="form-control"  required type="text" id="modelno${totalrows}" name="modelno${totalrows}" placeholder="Model No."  >
            </td>
            <td>
                <input class="form-control" required type="text" id="price${totalrows}" name="price${totalrows}" placeholder="Price"  >
            </td>
            <td>
                <input class="form-control" required type="text" id="qty${totalrows}" name="qty${totalrows}" placeholder="Qty."  value="1" >
            </td>
            
                <td>  
                <input class="form-control" type="text" name="brandid${totalrows}" hidden   id="brandid${totalrows}"  >
                <input class="form-control"  type="text" name="modelid${totalrows}" hidden   id="modelid${totalrows}"  > 
                <input class="form-control"  type="text" name="categoriesid${totalrows}" hidden  id="categoriesid${totalrows}"  > 
                <input class="form-control"  type="text" name="hsnmobile${totalrows}"  hidden id="hsnmobile${totalrows}"   >
                <input class="form-control"  type="text" name="gstpercent${totalrows}" hidden id="gstpercent${totalrows}"   >  
                </td>          
        </tr>`
            );
        }

        $('#addnewrow').click(() => {
            $('#rows').append(newrow())
        });


        $('#removerow').click(() => {
            $(`#row${totalrows}`).remove();
            totalrows--;
            $('#totalrows').val(totalrows);
        });

        function myclick(btns) {
            //alert(btns);
            const imeimob = $(`#imeimob${btns}`).val();
            const storeid = $('#storeid').val();
            $.post("getmobile", {
                    imeimob,
                    storeid
                },
                function (data, status) {
                    console.log(data)

                    if (data.feedstock[0].storeid == null && data.feedstock[0].storename == null) {
                        alert("Product Not Found");
                    } else if (data.feedstock[0].storeid == 0 && data.feedstock[0].storename == "SOLD") {
                        alert("Product Is SOLD");
                    } 
                    else if (data.feedstock[0].storeid == 0 && data.feedstock[0].storename == "Not distributed") {
                        alert("Product Is Not Distributed By Amit Sir");
                    }
                    
                    else if (data.feedstock[0].storeid == null && data.feedstock[0].storename != null) {
                        alert("Currently Product Is Not Present At your Store\nPlease Contact\n" + data.feedstock[0]
                            .storename);
                    } else {
                        $(`#color${btns}`).val(data.feedstock[0].color);
                        $(`#price${btns}`).val(data.feedstock[0].price);
                        $(`#brandname${btns}`).val(data.brand[0].name);
                        $(`#brandid${btns}`).val(data.feedstock[0].brandid);
                        $(`#modelid${btns}`).val(data.feedstock[0].modelid);
                        $(`#modelname${btns}`).val(data.model[0].name);
                        $(`#modelno${btns}`).val(data.model[0].modelno);
                        $(`#ptype${btns}`).val(data.categories[0].name);

                        $(`#brandid${btns}`).val(data.feedstock[0].brandid);
                        $(`#modelid${btns}`).val(data.feedstock[0].modelid);
                        $(`#gstpercent${btns}`).val(data.categories[0].percentage);
                        $(`#hsnmobile${btns}`).val(data.categories[0].hsn);
                        $(`#categoriesid${btns}`).val(data.categories[0].id);

                    }

                    //console.log(data.feedstock[0].id)
                    //alert("Data: " + data + "\nStatus: " + status);                  
                });

        }




        // Get Product  On Click       
     /*    $(document).ready(function () {
            $("#getmobile").click(function () {
                const imeimob = $('#imeimob').val();
                const storeid = $('#storeid').val();
                $.post("getmobile", {
                        imeimob,
                        storeid
                    },
                    function (data, status) {
                        console.log(data)

                        if (data.feedstock[0].storeid == null && data.feedstock[0].storename ==
                            null) {
                            alert("Product Not Found");
                        } else if (data.feedstock[0].storeid == 0 && data.feedstock[0].storename ==
                            "SOLD") {
                            alert("Product Is SOLD");
                        } else if (data.feedstock[0].storeid == null && data.feedstock[0]
                            .storename != null) {
                            alert("Currently Product Is Not Present At your Store\nPlease Contact\n" +
                                data.feedstock[0].storename);
                        }
                        
                       
                        
                        else {
                            $("#color").val(data.feedstock[0].color);
                            $("#price").val(data.feedstock[0].price);
                            $("#brandname").val(data.brand[0].name);
                            $("#brandid").val(data.feedstock[0].brandid);
                            $("#modelid").val(data.feedstock[0].modelid);
                            $("#modelname").val(data.model[0].name);
                            $("#modelno").val(data.model[0].modelno);
                            $("#ptype").val(data.categories[0].name);
                            $("#gstpercent").val(data.categories[0].percentage);
                            $("#hsnmobile").val(data.categories[0].hsn);
                            $("#categoriesid").val(data.categories[0].id);

                        }

                        //console.log(data.feedstock[0].id)
                        //alert("Data: " + data + "\nStatus: " + status);                  
                    });
            });
        });
 */

        //On Change Payment Type
        $(function () {
            $("#paytype").on('change', function () {

                /* if(this.value=="cash"){
                     
                     $('#fcname').prop('hidden', true);
                     $("#fcname").val(0);
                 }
                 else if(this.value=="card"){
                     
                     $('#fcname').prop('hidden', true);
                     $("#fcname").val(0);
                 }
                 else if(this.value=="cheque"){
                     
                     $('#fcname').prop('hidden', true);
                     $("#fcname").val(0);
                 }
                 else{
                     $('#fcname').prop('hidden', false);
                 }*/
            })
        });






        // Get Cutomer by Card On Click
        $(document).ready(function () {
            $("#getcustcard").click(function () {
                const ccard = $('#ccard').val();

                $.post("getcustcard", {
                        ccard,
                    },
                    function (data, status) {
                        if (data == "Server Error") {
                            alert("Server Error");
                        } else if (data == "Customer Not Exist") {
                            alert("Customer Not Exist");
                        } else {
                            $("#cname").val(data[0].name);
                            $("#cadd").val(data[0].address);
                            $("#cgstno").val(data[0].cgstno);
                            $("#cmobile").val(data[0].mobile);
                        }
                    });
            });
        });







        // Get Cutomer By Mobile On Click
        $(document).ready(function () {
            $("#getcustomer").click(function () {
                const cmob = $('#cmobile').val();

                $.post("getcustomer", {
                        cmob,
                    },
                    function (data, status) {
                        if (data == "Server Error") {
                            alert("Server Error");
                        } else if (data == "Customer Not Exist") {
                            alert("Customer Not Exist");
                        } else {
                            $("#cname").val(data[0].name);
                            $("#cadd").val(data[0].address);
                            $("#cgstno").val(data[0].cgstno);
                            $("#ccard").val(data[0].ccard);
                        }
                    });
            });
        });


        // Genrate Bill

        /*
        $(document).ready(function(){
                     $("#genratebill").click(function(){
                        const gstoreid = $('#storeid').val();
                        const gstorename = $('#storename').val();
                        const gstoreaddress = $('#storeaddress').val();
                        const gstoregstno = $('#storegstno').val();
                        const gbrandid = $('#brandid').val();
                        const gmodelid = $('#modelid').val();
                        const gcategoriesid = $('#categoriesid').val();
                        const gimeino = $('#imeimob').val();
                        const gmobileno = $('#cmobile').val();
                        const gproducttype = $('#ptype').val();
                        const gbrandname = $('#brandname').val();
                        const gcolor = $('#color').val();
                        const gmodelname = $('#modelname').val();
                        const gmodelno = $('#modelno').val();
                        const ghsn = $('#hsnmoble').val();
                        const ggstpercent = $('#gstpercent').val();
                        const gprice = $('#price').val();
                        const gqty = $('#qty').val();
                        const gcustomername = $('#cname').val();
                        const gcustomeradd = $('#cadd').val();
                        const ggstin = $('#cgstno').val();
                        const gpaytype = $('#paytype').val();
                        const gfcname = $('#fcname').val();


                       
                       
                        
                        $.post("sold",
                        {
                            gstoreid,gstorename,gstoreaddress,gstoregstno,gbrandid,gmodelid,gcategoriesid,gimeino,gmobileno,gproducttype,
                             gbrandname,gcolor,gmodelname,gmodelno,ghsn,ggstpercent,gprice,gqty,gcustomername,gcustomeradd,ggstin,gpaytype,gfcname  
                       
                        },
                        function(data,status){
                            if(data=="Server Error")
                            {
                                alert("Server Error");
                            }
                            else if(data=="Customer Not Exist")
                            {
                                alert("Customer Not Exist");                                          
                            }
                            else {
                            $("#cname").val(data[0].name);
                            $("#cadd").val(data[0].address);
                            $("#cgstno").val(data[0].cgstno); 
                            }  
                            alert(data)               
                        });
                      });
                    });
        */



















        /*
        function myFunction() {
          window.print();
        }
        */
    </script>

</body>

</html>